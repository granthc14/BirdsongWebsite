<style>
  table {
      font-size: 18px;
  }

  .add {
    color: #4CAF50!important;
    margin-right: 16px!important;
  }
  .add:hover {
      color: #4CAF50!important;
      margin-right: 16px!important;
    }
  .add:focus {
      color: #4CAF50!important;
      margin-right: 16px!important;
    }

  .remove {
    color: #f44336!important;
    float: right;
  }
  .remove:hover {
    color: #f44336!important;
    float: right;
  }
  .remove:focus {
    color: #f44336!important;
    float: right;
  }
</style>

<div class="w3-container">
  <div class="w3-right-align">
    <h2 class="w3-right-align">
    <a href="#"><span class="add glyphicon glyphicon-plus" onclick="document.getElementById('concessionModal').style.display='block'">
    </span></a>
  </h2>
  </div>
</div>

<div class="w3-container">
    <div class="w3-half">
        <div class="w3-card-4 w3-margin" id="foodHalf">
            <header class="w3-container w3-blue">
                <h1>Food</h1>
            </header>
            <table class="w3-table w3-striped w3-padding-32">
              <tbody>
                <tr>
                    <th>Name</th>
                    <th>Price</th>
                    <th>Has Condiments</th>
                    <th>&nbsp;</th>
                </tr>
                <!-- food populates here -->
              </tbody>
            </table>
        </div>
    </div>
    <div class="w3-half">
        <div class="w3-card-4 w3-margin" id="drinkHalf" style="vertical-align: center;">
            <header class="w3-container w3-blue">
              <h1>Drinks</h1>
            </header>
            <table class="w3-table w3-striped w3-padding-32">
              <tbody>
                <tr>
                    <th>Name</th>
                    <th>Price</th>
                    <th>&nbsp;</th>
                </tr>
                <!-- drinks populate here -->
              </tbody>
            </table>
        </div>
    </div>
</div>
<br>
<div class="w3-container">
    <div class="w3-half">
        <div class="w3-card-4 w3-margin" id="popcornHalf">
            <header class="w3-container w3-blue">
              <h1>Popcorn</h1>
            </header>
            <table class="w3-table w3-striped w3-padding-32">
              <tbody>
                <tr>
                    <th>Name</th>
                    <th>Price</th>
                    <th>&nbsp;</th>
                </tr>
                <!-- popcorn populates here -->
              </tbody>
            </table>
        </div>
    </div>
    <div class="w3-half">
        <div class="w3-card-4 w3-margin" id="candyHalf">
            <header class="w3-container w3-blue">
              <h1>Candy</h1>
            </header>
            <table class="w3-table w3-striped w3-padding-32">
              <tbody>
                <tr>
                    <th>Name</th>
                    <th>Price</th>
                    <th>&nbsp;</th>
                </tr>
                <!-- candy populates here -->
              </tbody>
            </table>
        </div>
    </div>
    <div class="w3-half">
        <div class="w3-card-4 w3-margin" id="combosHalf">
            <header class="w3-container w3-blue">
              <h1>Combos
                <a href="#"><span class="add glyphicon glyphicon-plus" onclick="document.getElementById('combosModal').style.display='block'">
                </span></a>
              </h1>
            </header>
            <table class="w3-table w3-striped w3-padding-32">
              <tbody>
                <tr>
                    <th>Name</th>
                    <th>Price</th>
                    <th>&nbsp;</th>
                </tr>
                <!-- combos populates here -->
              </tbody>
            </table>
        </div>
    </div>
</div>

<!-- modal for adding food/drink/etc. -->
<div id="concessionModal" class="w3-modal">
  <div class="w3-modal-content">

    <header class="w3-container w3-green">
      <span onclick="document.getElementById('concessionModal').style.display='none'"
      class="w3-button w3-display-topright">&times;</span>
      <h2>Add Concession Item</h2>
    </header>
    <br>

    <div class="w3-container">
      <label class="w3-text-gray">Name</label>
      <input class="concessionInput w3-input w3-border" id="name" type="text" required></input>
      <br>

      <label class="w3-text-gray">Price</label>
      <input class="concessionInput w3-input w3-border" id="price" type="number" required></input>
      <br>

      <label class="w3-text-gray">Concession Type</label>
      <select class="concessionInput w3-select w3-border" id="concessionType" name="option">
        <option value="" disabled selected>Choose concession type...</option>
        <option value="food">Food</option>
        <option value="drink">Drink</option>
        <option value="popcorn">Popcorn</option>
        <option value="candy">Candy</option>
      </select>
      <br><br>

      <input class="w3-check" id="condiments" type="checkbox" style="width: 15px; height: 15px; top: 3px;">
      <label class="w3-text-gray" style="display: inline;"> Has Condiments (Select this field to add a special
        case item. Foods with this option have the ability to have lettuce, tomatoes,
        onions, and pickles. Drinks with this option are allowed to be Coke products.)</label><br>
      <br>

      <button class="w3-button w3-green" id="submitBtn">Submit</button><br><br>
    </div>
  </div>
</div>

<!-- modal for adding combos -->
<div id="combosModal" class="w3-modal">
  <div class="w3-modal-content">

    <header class="w3-container w3-green">
      <span onclick="document.getElementById('combosModal').style.display='none'"
      class="w3-button w3-display-topright">&times;</span>
      <h2>Add Combo</h2>
    </header>
    <br>

    <div class="w3-container">
      <label class="w3-text-gray">Name</label>
      <input class="comboInput w3-input w3-border" id="comboName" type="text" required></input>
      <br>

      <div class="w3-row">
        <div class="w3-twothird">
          <label class="w3-text-gray">Items</label>
          <select id="comboDropdown" class="comboInput w3-select w3-border" name="option">
            <option value="" disabled selected>Choose concession item...</option>
            <!-- concession items go here -->
          </select>
        </div>

        <div class="w3-third">
          <label class="w3-text-gray">Amount</label>
          <input class="comboInput w3-input w3-border" id="comboAmount" type="number" required></input>
        </div>
      </div>
      <br><br>

      <label class="w3-text-gray">Combo Price</label>
      <input class="comboInput w3-input w3-border" id="comboPrice" type="number" required></input>
      <br>

      <button class="w3-button w3-green" id="comboSubmitBtn">Submit</button><br><br>
    </div>
  </div>
</div>

<div id="failModal" class="w3-modal">
  <div class="w3-modal-content">

    <header class="w3-container w3-green">
      <span onclick="document.getElementById('failModal').style.display='none'"
      class="w3-button w3-display-topright">&times;</span>
      <h2>&nbsp;</h2>
    </header><br>

    <div class="w3-container">
      <h4>There was an error with adding or deleting this item.<br><br>Please try again.</h4>
    </div><br>
  </div>
</div>

<script>
// $('#drinkHalf').height($('#foodHalf').height());
// $('#candyHalf').height($('#popcornHalf').height());

//populate concession items from json string
function loadConcessions() {
  $.getJSON("/get_concessions", function(data) {
    $.each(data, function(i, item) {
      var condiments = "No";
      if (item.hasCondiments === true) {
        condiments = "Yes";
      }
      var price = parseFloat(item.price).toFixed(2);

      var $tr=$('<tr class=\'tableBody\'></tr>');
      $tr.append($('<td></td>',{text : item.name}));
      $tr.append($('<td></td>',{text : '$'+price}));
      if (item.type == "food") {
        $tr.append($('<td></td>',{text : condiments}));
      }
      $tr.append($('<td><a href="#" class="deleteBtn" data-name="'+item.name+'" data-price="'+item.price+'" data-type="'+item.type+'" data-hasCondiments="'+item.hasCondiments+'">'
        +'<span class="remove glyphicon glyphicon-remove"></span></a></td>'));
      //append each item to the corresponding table (food, drinks, etc.)
      $('#'+item.type+'Half').find('tbody').append($tr);

      //add items to dropdown for combos
      $('#comboDropdown').append('<option value="'+i+'">'+item.name+' - $'+price+'</option>');

    });
  });
}

$(document).ready(function() {
  loadConcessions();

  //to make concession form submit on 'enter' and not just on clicking submit
  $(".concessionInput").keyup(function(event) {
    if (event.keyCode === 13) {
        $("#submitBtn").click();
    }
  });
  // $('select').change(function(event) {
  //   if (event.keyCode === 13) {
  //     $("#submitBtn").click();
  //   }
  // });

  //add concession items
  $('#submitBtn').on('click', function() {
    var name = $('#name').val();
    var price = $('#price').val();
    var type = $('#concessionType').find(":selected").val();
    var hasCondiments = $('#condiments').is(':checked');
    var jsonObj = {
      name: name,
      price: price,
      type: type,
      hasCondiments: hasCondiments
    }

    $.ajax({
      type: 'PUT',
      url: '/add_concession/',
      dataType: 'JSON',
      contentType: "application/json; charset=utf-8",
      data: JSON.stringify(jsonObj),
      success: function(data) {
        // $('#concessionModal').hide();
        location.reload();
        loadConcessions();
      },
      error: function(data) {
        $('#concessionModal').hide();
        $('#failModal').show();
      }
    })
  });

  $('#comboSubmitBtn').on('click', function() {
    var name = $('#comboName').val();
    var price = $('#comboPrice').val();
    var jsonObj = {
      name: name,
      price: price,
      type: "combo"
    }

    $.ajax({
      type: 'PUT',
      url: '/add_concession/',
      dataType: 'JSON',
      contentType: "application/json; charset=utf-8",
      data: JSON.stringify(jsonObj),
      success: function(data) {
        // $('#concessionModal').hide();
        location.reload();
        loadConcessions();
      },
      error: function(data) {
        $('#concessionModal').hide();
        $('#failModal').show();
      }
    })
  });

  //delete concession items
  $(document).on('click', '.deleteBtn', function() {
    var self = $(this);
    var name = self.data("name");
    var price = self.data("price");
    var type = self.data("type");
    var hasCondiments = self.data("hasCondiments");
    var jsonObj = {
      name: name,
      price: price,
      type: type,
      hasCondiments: hasCondiments
    }

    $.ajax({
      type: 'PUT',
      url: '/delete_concession',
      dataType: 'JSON',
      contentType: "application/json; charset=utf-8",
      data: JSON.stringify(jsonObj),
      success: function(data) {
        location.reload();
        loadConcessions();
      },
      error: function(data) {
        $('#failModal').show();
      }
    })
  });

});
</script>
