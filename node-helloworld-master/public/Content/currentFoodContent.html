<style>
  table {
      font-size: 18px;
  }

  .add {
    color: #4CAF50!important
  }
  .add:hover {
      color: #4CAF50!important
    }
  .add:focus {
      color: #4CAF50!important
    }
</style>

<div class="w3-container">
      <div class="w3-right-align">
        <h2 class="w3-right-align">
        <span class="add glyphicon glyphicon-plus" onclick="document.getElementById('concessionModal').style.display='block'">
        </span>
      </h2>
      </div>
</div>

<div class="w3-container">
    <div class="w3-half">
        <div class="w3-card-4 w3-margin" id="foodHalf">
            <header class="w3-container w3-blue">
                <h1>Food</h1>
            </header>
            <table class="w3-table w3-striped w3-padding-32">
              <tbody>
                <!-- food populates here -->
              </tbody>
            </table>
        </div>
    </div>
    <div class="w3-half">
        <div class="w3-card-4 w3-margin" id="drinkHalf" style="vertical-align: center;">
            <header class="w3-container w3-blue">
              <h1>Drinks</h1>
            </header>
            <table class="w3-table w3-striped w3-padding-32">
              <tbody>
                <!-- drinks populate here -->
              </tbody>
            </table>
        </div>
    </div>
</div>
<br>
<div class="w3-container">
    <div class="w3-half">
        <div class="w3-card-4 w3-margin" id="popcornHalf">
            <header class="w3-container w3-blue">
              <h1>Popcorn</h1>
            </header>
            <table class="w3-table w3-striped w3-padding-32">
              <tbody>
                <!-- popcorn populates here -->
              </tbody>
            </table>
        </div>
    </div>
    <div class="w3-half">
        <div class="w3-card-4 w3-margin" id="candyHalf">
            <header class="w3-container w3-blue">
              <h1>Candy</h1>
            </header>
            <table class="w3-table w3-striped w3-padding-32">
              <tbody>
                <!-- candy populates here -->
              </tbody>
            </table>
        </div>
    </div>
</div>
<br>
<div class="w3-container">
    <div class="w3-half">
        <div class="w3-card-4 w3-margin" id="condimentsHalf">
            <header class="w3-container w3-blue">
              <h1>Condiments</h1>
            </header>
            <table class="w3-table w3-striped w3-padding-32">
              <tbody>
                <!-- condiments populate here -->
              </tbody>
            </table>
        </div>
    </div>
    </div>
</div>

<!-- modal for adding food/drink/etc. -->
<div id="concessionModal" class="w3-modal">
  <div class="w3-modal-content">

    <header class="w3-container w3-green">
      <span onclick="document.getElementById('concessionModal').style.display='none'"
      class="w3-button w3-display-topright">&times;</span>
      <h2>Add Concession Item</h2>
    </header>
    <br>

    <div class="w3-container">
      <label class="w3-text-gray">Name</label>
      <input class="w3-input w3-border" id="name" type="text" required></input>
      <br>

      <label class="w3-text-gray">Price</label>
      <input class="w3-input w3-border" id="price" type="number" required></input>
      <br>

      <label class="w3-text-gray">Concession Type</label>
      <select class="w3-select w3-border" id="concessionType" name="option">
        <option value="" disabled selected>Choose concession type...</option>
        <option value="food">Food</option>
        <option value="drink">Drink</option>
        <option value="popcorn">Popcorn</option>
        <option value="candy">Candy</option>
        <option value="condiments">Condiments</option>
      </select>
      <br><br>

      <button class="w3-button w3-green" id="submitBtn">Submit</button><br><br>
    </div>
  </div>
</div>

<div id="failModal" class="w3-modal">
  <div class="w3-modal-content">

    <header class="w3-container w3-green">
      <span onclick="document.getElementById('failModal').style.display='none'"
      class="w3-button w3-display-topright">&times;</span>
      <h2>&nbsp;</h2>
    </header><br>

    <div class="w3-container">
      <h4>There was an error with adding or deleting this item.<br><br>Please try again.</h4>
    </div><br>
  </div>
</div>

<script>
// $('#drinkHalf').height($('#foodHalf').height());
// $('#candyHalf').height($('#popcornHalf').height());

//populate concession items from json string
function loadConcessions() {
  console.log('loading concessions');
  $.getJSON("/get_concessions", function(data) {
    $.each(data, function(i, item) {
      var $tr=$('<tr class=\'tableBody\'></tr>');
      $tr.append($('<td></td>',{text : item.name}));
      $tr.append($('<td></td>',{text : '$'+item.price}));
      $tr.append($('<td><a href="#" class="deleteBtn" data-name="'+item.name+'" data-price="'+item.price+'" data-type="'+item.type+'">Delete</a></td>'));
      //append each item to the corresponding table (food, drinks, etc.)
      $('#'+item.type+'Half').find('tbody').append($tr);
    });
  });
}

$(document).ready(function() {
  loadConcessions();

  //add concession items
  $('#submitBtn').on('click', function() {
    var name = $('#name').val();
    var price = $('#price').val();
    var type = $('#concessionType').find(":selected").val();
    var jsonObj = {
      name: name,
      price: price,
      type: type
    }

    $.ajax({
      type: 'PUT',
      url: '/add_concession/',
      dataType: 'JSON',
      contentType: "application/json; charset=utf-8",
      data: JSON.stringify(jsonObj),
      success: function(data) {
        // $('#concessionModal').hide();
        location.reload();
        loadConcessions();
      },
      error: function(data) {
        $('#concessionModal').hide();
        $('#failModal').show();
      }
    })
  });

  //delete concession items
  $(document).on('click', '.deleteBtn', function() {
    var self = $(this);
    var name = self.data("name");
    var price = self.data("price");
    var type = self.data("type");
    var jsonObj = {
      name: name,
      price: price,
      type: type
    }

    $.ajax({
      type: 'PUT',
      url: '/delete_concession',
      dataType: 'JSON',
      contentType: "application/json; charset=utf-8",
      data: JSON.stringify(jsonObj),
      success: function(data) {
        location.reload();
        loadConcessions();
      },
      error: function(data) {
        $('#failModal').show();
      }
    })
  });

});
</script>
